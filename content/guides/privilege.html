<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>权限管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../css/incubator.css" rel="stylesheet">
    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../css/asciidoctor.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/prettify.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="https://www.apache.org/favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">
   

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://doris.apache.org"><i class="icon-home"></i>Apache Doris</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documents <b class="caret"></b></a>
              <ul class="dropdown-menu">
                
                  <li><a href="http://doris.apache.org/guides/backup-restore.html">备份与恢复</a></li>
                
                  <li><a href="http://doris.apache.org/guides/deploy-upgrade.html">部署和升级</a></li>
                
                  <li><a href="http://doris.apache.org/guides/metadata-design.html">元数据设计文档</a></li>
                
                  <li><a href="http://doris.apache.org/guides/best-practices.html">最佳实践</a></li>
                
                  <li><a href="http://doris.apache.org/guides/documents.html">Doris 文档</a></li>
                
                  <li><a href="http://doris.apache.org/guides/monitor-alert.html">监控和报警</a></li>
                
                  <li><a href="http://doris.apache.org/guides/create-load-and-delete.html">建表、数据导入与删除</a></li>
                
                  <li><a href="http://doris.apache.org/guides/multi-tenant.html">多租户设计</a></li>
                
                  <li><a href="http://doris.apache.org/guides/data-model-rollup-prefix-index.html">数据模型和索引</a></li>
                
                  <li><a href="http://doris.apache.org/guides/install.html">安装文档</a></li>
                
                  <li><a href="http://doris.apache.org/guides/privilege.html">权限管理</a></li>
                
                  <li><a href="http://doris.apache.org/guides/sql_reference.html">SQL reference</a></li>
                
                  <li><a href="http://doris.apache.org/guides/getting-start.html">Tutorial</a></li>
                
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Community <b class="caret"></b></a>
              <ul class="dropdown-menu">
                
                  <li><a href="http://doris.apache.org/policy/release_process.html">Apache Doris 发布流程</a></li>
                
                  <li><a href="http://doris.apache.org/policy/pmc.html">PMC Members & Committer</a></li>
                
                  <li><a href="http://doris.apache.org/policy/contributing.html">如何做贡献</a></li>
                
                  <li><a href="http://doris.apache.org/policy/subscribe-mail-list.html">订阅邮件列表</a></li>
                
                  <li><a href="http://doris.apache.org/policy/use-gitter.html">Gitter 使用指南</a></li>
                
                  <li><a href="http://doris.apache.org/policy/pull-request.html">代码提交指南</a></li>
                
              </ul>
             </li> 

	    <li><a href="http://doris.apache.org/downloads.html">Downloads </a></li>
	    <li><a href="http://doris.apache.org/faq.html">FAQs </a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-md-4 vcenter"><a href="https://www.apache.org/"><img src="https://www.apache.org/img/asf_logo.png" alt="The Apache Software Foundation" border="0" style="margin-top: 2px" height="175"></a></div>
	<div class="col-md-4 vcenter"><a href="/"><img src="../images/doris-logo-2.png" alt="Apache Doris" border="0" style="margin-left: 70px; margin-top: 2px" height="175"></a></div>
	<div class="col-md-4 vcenter"><a href="https://github.com/apache/incubator-doris"><img src="../images/github.jpg" alt="GitHub repository" border="0" style="margin-left: 0px; margin-top: 135px" height="40"></a></div>
      </div>
    </div>
    <div class="top-container container">


<div class="page-header">
    <h1>Guide :: 权限管理</h1>
</div>

<div class="article-body">

Estimated Reading Time: <span class="eta"></span>

<p><h1><a href="#privilege-doris权限管理" id="privilege-doris权限管理">Privilege Doris权限管理</a></h1> 
<p>Doris 新的权限管理系统参照了 Mysql 的权限管理机制，做到了表级别细粒度的权限控制，基于角色的权限访问控制，并且支持白名单机制。</p> 
<h2><a href="#名词解释" id="名词解释">名词解释</a></h2> 
<ol> 
 <li> <p>用户标识 user_identity</p> <p>在权限系统中，一个用户被识别为一个 User Identity（用户标识）。用户标识由两部分组成：username 和 userhost。其中 username 为用户名，由英文大小写组成。userhost 表示该用户链接来自的 IP。user_identity 以 username@‘userhost’ 的方式呈现，表示来自 userhost 的 username。</p> <p>user_identity 的另一种表现方式为 username@[‘domain’]，其中 domain 为域名，可以通过 DNS 会 BNS（百度名字服务）解析为一组 ip。最终表现为一组 username@‘userhost’，所以后面我们统一使用 username@‘userhost’ 来表示。</p> </li> 
 <li> <p>权限 Privilege</p> <p>权限作用的对象是节点、数据库或表。不同的权限代表不同的操作许可。</p> </li> 
 <li> <p>角色 Role</p> <p>Doris可以创建自定义命名的角色。角色可以被看做是一组权限的集合。新创建的用户可以被赋予某一角色，则自动被赋予该角色所拥有的权限。后续对角色的权限变更，也会体现在所有属于该角色的用户权限上。</p> </li> 
 <li> <p>用户属性 user_property</p> <p>用户属性直接附属于某一用户，而不是用户标识。即 cmy@‘192.%’ 和 cmy@[‘domain’] 都拥有同一组用户属性，该属性属于用户 cmy，而不是 cmy@‘192.%’ 或 cmy@[‘domain’]。</p> <p>用户属性包括但不限于： 用户最大连接数、导入集群配置等等。</p> </li> 
</ol> 
<h2><a href="#支持的操作" id="支持的操作">支持的操作</a></h2> 
<ol> 
 <li>创建用户：CREATE USER</li> 
 <li>删除用户：DROP USER</li> 
 <li>授权：GRANT</li> 
 <li>撤权：REVOKE</li> 
 <li>创建角色：CREATE ROLE</li> 
 <li>删除角色：DROP ROLE</li> 
 <li>查看当前用户权限：SHOW GRANTS</li> 
 <li>查看所有用户权限：SHOW ALL GRANTS</li> 
 <li>查看已创建的角色：SHOW ROELS</li> 
 <li>查看用户属性：SHOW PROPERTY</li> 
</ol> 
<p>关于以上命令的详细帮助，可以通过 mysql 客户端连接 Doris 后，使用 help + command 获取帮助。如 <code>help create user</code>。</p> 
<h2><a href="#权限说明" id="权限说明">权限说明</a></h2> 
<p>Doris 目前支持以下几种权限</p> 
<ol> 
 <li> <p>Node_priv</p> <p>节点变更权限。包括 FE、BE、BROKER 节点的添加、删除、下线等操作。目前该权限只能授予 Root 用户。</p> </li> 
 <li> <p>Grant_priv</p> <p>权限变更权限。允许执行包括授权、撤权、添加/删除/变更 用户/角色 等操作。</p> </li> 
 <li> <p>Select_priv</p> <p>对数据库、表的只读权限。</p> </li> 
 <li> <p>Load_priv</p> <p>对数据库、表的写权限。包括 Load、Insert、Delete 等。</p> </li> 
 <li> <p>Alter_priv</p> </li> 
</ol> 
<p>对数据库、表的更改权限。包括重命名 库/表、添加/删除/变更 列等操作。</p> 
<ol> 
 <li>Create_priv</li> 
</ol> 
<p>创建数据库、表的权限。</p> 
<ol> 
 <li>Drop_priv <p>删除数据库、表的权限。</p> </li> 
</ol> 
<h2><a href="#一些说明" id="一些说明">一些说明</a></h2> 
<ol> 
 <li> <p>Doris 初始化时，会自动创建如下用户和角色：</p> 
  <ol> 
   <li> <p>operator 角色：该角色拥有 Node_priv 和 Admin_priv，即对Doris的所有权限。后续某个升级版本中，我们可能会将该角色的权限限制为 Node_priv，即仅授予节点变更权限。以满足某些云上部署需求。</p> </li> 
   <li> <p>admin 角色：该角色拥有 Admin_priv，即除节点变更以外的所有权限。</p> </li> 
   <li> <p>root@‘%’：root 用户，允许从任意节点登陆，角色为 operator。</p> </li> 
   <li> <p>admin@‘%’：admin 用户，允许从任意节点登陆，角色为 admin。</p> </li> 
  </ol> </li> 
 <li> <p>不支持删除或更改默认创建的角色或用户的权限。</p> </li> 
 <li> <p>operator 角色的用户有且只有一个。admin 角色的用户可以创建多个。</p> </li> 
 <li> <p>一些可能产生冲突的操作说明</p> 
  <ol> 
   <li> <p>域名与ip冲突：</p> <p>假设创建了如下用户：</p> <p>CREATE USER cmy@[‘domain’];</p> <p>并且授权：</p> <p>GRANT SELECT_PRIV ON *.* TO cmy@[‘domain’]</p> <p>该 domain 被解析为两个 ip：ip1 和 ip2</p> <p>假设之后，我们对 cmy@‘ip1’ 进行一次单独授权：</p> <p>GRANT ALTER_PRIV ON *.* TO cmy@‘ip1’;</p> <p>则 cmy@‘ip1’ 的权限会被修改为 SELECT_PRIV, ALTER_PRIV。并且当我们再次变更 cmy@[‘domain’] 的权限时，cmy@‘ip1’ 也不会跟随改变。</p> </li> 
   <li> <p>重复ip冲突：</p> <p>假设创建了如下用户：</p> <p>CREATE USER cmy@‘%’ IDENTIFIED BY “12345”;</p> <p>CREATE USER cmy@‘192.%’ IDENTIFIED BY “abcde”;</p> <p>在优先级上，‘192.%’ 优先于 ‘%’，因此，当用户 cmy 从 192.168.1.1 这台机器尝试使用密码 ‘12345’ 登陆 Doris 会被拒绝。</p> </li> 
   <li> <p>权限冲突</p> </li> 
  </ol> </li> 
 <li> <p>忘记密码</p> <p>如果忘记了密码无法登陆Doris，可以在 Doris FE 节点所在机器，使用如下命令无密码登陆 Doris：</p> <p><code>mysql-client -h 127.0.0.1 -P query_port -uroot</code></p> <p>登陆后，可以通过 SET PASSWORD 命令重置密码。</p> </li> 
 <li> <p>任何用户都不能重置 root 用户的密码，除了 root 用户自己。</p> </li> 
 <li> <p>ADMIN_PRIV 和 GRANT_PRIV 权限只能 <code>GRANT ON *.*</code> 或 <code>REVOKE FROM *.*</code>。因为对于指定的库和表，这两个权限没有意义。同时，拥有 GRANT_PRIV 其实等同于拥有 ADMIN_PRIV，因为 GRANT_PRIV 有授予任意权限的权限。请谨慎使用。</p> </li> 
</ol></p>

</div>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
          <p class="muted credit">&copy; 2017 The Apache Software Foundation | Licensed under the Apache License, Version 2.0.<br/>
          Apache Incubator, Apache, the Apache feather logo, and the Apache Incubator project logo are trademarks of The Apache Software Foundation.</p>
      </div>
    </div>

    <script src="../js/jquery-1.11.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/prettify.js"></script>
    <script src="../js/readingTime.js"></script>
    <script src="../js/incubator.js"></script>

  </body>
</html>
